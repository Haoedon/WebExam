<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #45a049; }
        .result { margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 4px; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        h2 { color: #333; margin-top: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</h1>
        
        <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</h2>
        <button onclick="checkCart()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ localStorage</button>
        <div id="cartResult" class="result"></div>

        <h2>–®–∞–≥ 2: –¢–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ save_order.php</h2>
        <p style="color: #666; font-size: 12px;">‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code>python server.py</code></p>
        <button onclick="testPostRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π POST –Ω–∞ save_order.php</button>
        <div id="postResult" class="result"></div>

        <h2>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
        <button onclick="checkOrders()">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</button>
        <div id="ordersResult" class="result"></div>

        <h2>–®–∞–≥ 4: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ cart.html –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</h2>
        <button onclick="goToCart()">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—Ä–∑–∏–Ω—ã</button>
        <p style="color: #666; font-size: 12px;">–ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å"</p>
    </div>

    <script>
        function checkCart() {
            const result = document.getElementById('cartResult');
            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cart.length === 0) {
                    result.innerHTML = '‚ùå –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!\n\n–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞—Ç–∞–ª–æ–≥–∞.';
                    result.classList.add('error');
                } else {
                    result.innerHTML = `‚úÖ –í –∫–æ—Ä–∑–∏–Ω–µ ${cart.length} —Ç–æ–≤–∞—Ä(–æ–≤):\n\n${JSON.stringify(cart, null, 2)}`;
                }
            } catch (e) {
                result.innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + e.message;
                result.classList.add('error');
            }
        }

        async function testPostRequest() {
            const result = document.getElementById('postResult');
            result.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –¥–ª—è —Ç–µ—Å—Ç–∞
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cart.length === 0) {
                    result.innerHTML = '‚ùå –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É';
                    result.classList.add('error');
                    return;
                }

                const formData = new FormData();
                formData.append('fio', '–ò–≤–∞–Ω –¢–µ—Å—Ç–æ–≤');
                formData.append('email', 'ivan@test.com');
                formData.append('phone', '+7 (999) 999-99-99');
                formData.append('address', '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, –¥. 1');
                formData.append('deliveryDate', new Date(Date.now() + 86400000).toISOString().split('T')[0]);
                formData.append('deliveryTime', 'afternoon');
                formData.append('comment', '');
                formData.append('newsletter', 'off');
                formData.append('cart_data', JSON.stringify({
                    items: cart,
                    total: cart.reduce((sum, item) => sum + (item.price || 0), 0) + 200
                }));

                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ save_order.php...');
                const response = await fetch('save_order.php', {
                    method: 'POST',
                    body: formData
                });

                console.log('–°—Ç–∞—Ç—É—Å:', response.status);
                const data = await response.json();
                console.log('–û—Ç–≤–µ—Ç:', data);

                if (response.ok) {
                    result.innerHTML = `‚úÖ –£–°–ü–ï–®–ù–û!\n\n${JSON.stringify(data, null, 2)}\n\nüíæ –ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ orders.json`;
                } else {
                    result.innerHTML = `‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (${response.status}):\n\n${JSON.stringify(data, null, 2)}`;
                    result.classList.add('error');
                }
            } catch (e) {
                result.innerHTML = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:\n\n${e.message}\n\nüí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000`;
                result.classList.add('error');
            }
        }

        function goToCart() {
            window.location.href = 'cart.html';
        }

        async function checkOrders() {
            const result = document.getElementById('ordersResult');
            result.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
            
            try {
                const response = await fetch('orders.json');
                if (!response.ok) {
                    result.innerHTML = 'üìÑ –§–∞–π–ª orders.json –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω (–∑–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç)';
                    return;
                }
                
                const data = await response.json();
                result.innerHTML = `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${data.length} –∑–∞–∫–∞–∑(–æ–≤):\n\n${JSON.stringify(data, null, 2)}`;
            } catch (e) {
                result.innerHTML = '‚ö†Ô∏è –§–∞–π–ª orders.json –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkCart();
        });
    </script>
</body>
</html>
